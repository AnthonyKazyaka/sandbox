<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Analysis Review</title>
    <meta name="description" content="Review and filter photo analysis results">
    <link rel="stylesheet" href="review.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <h1>üì∑ Photo Analysis Review</h1>
            <p class="subtitle">Load your analysis results and filter photos</p>
            <button class="help-button" id="helpButton" title="Keyboard shortcuts (?)">‚å®Ô∏è Shortcuts</button>
        </header>

        <!-- File Upload Section -->
        <section class="upload-section" id="uploadSection">
            <div class="upload-card">
                <div class="upload-icon">üìÅ</div>
                <h2>Load Analysis Results</h2>
                <p>Select your <code>summary.json</code> file from the photo analyzer</p>
                <input type="file" id="fileInput" accept=".json" class="file-input">
                <label for="fileInput" class="upload-button">
                    Choose JSON File
                </label>
                
                <div class="upload-divider">
                    <span>Photo Directory (for thumbnails)</span>
                </div>
                
                <div class="directory-input-group">
                    <input type="file" id="photoDirectoryInput" webkitdirectory directory multiple class="file-input">
                    <label for="photoDirectoryInput" class="upload-button secondary">
                        üìÅ Select Photo Folder
                    </label>
                    <div id="directoryStatus" class="directory-status"></div>
                </div>
                
                <div class="upload-hint">
                    Generated by: <code>python analyze_photos.py INPUT_DIR --summary-json summary.json</code>
                </div>
            </div>
        </section>

        <!-- Main Content (hidden until file loaded) -->
        <main class="main-content" id="mainContent" style="display: none;">
            <!-- Summary Stats -->
            <section class="stats-section">
                <div class="stat-card">
                    <div class="stat-value" id="totalCount">0</div>
                    <div class="stat-label">Total Photos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="filteredCount">0</div>
                    <div class="stat-label">Showing</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="selectedCount">0</div>
                    <div class="stat-label">Selected</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="personCount">0</div>
                    <div class="stat-label">With People</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dogCount">0</div>
                    <div class="stat-label">With Dogs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="catCount">0</div>
                    <div class="stat-label">With Cats</div>
                </div>
            </section>

            <!-- Filters -->
            <section class="filters-section">
                <h2>üîç Filters</h2>
                <div class="filters-grid">
                    <!-- Blur Filter -->
                    <div class="filter-group">
                        <label for="blurFilter">Blur</label>
                        <select id="blurFilter" class="filter-select">
                            <option value="all">All</option>
                            <option value="sharp">Sharp only</option>
                            <option value="soft">Soft only</option>
                            <option value="blurry">Blurry only</option>
                        </select>
                    </div>

                    <!-- Person Filter -->
                    <div class="filter-group">
                        <label for="personFilter">Has Person</label>
                        <select id="personFilter" class="filter-select">
                            <option value="all">All</option>
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>

                    <!-- Dog Filter -->
                    <div class="filter-group">
                        <label for="dogFilter">Has Dog</label>
                        <select id="dogFilter" class="filter-select">
                            <option value="all">All</option>
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>

                    <!-- Cat Filter -->
                    <div class="filter-group">
                        <label for="catFilter">Has Cat</label>
                        <select id="catFilter" class="filter-select">
                            <option value="all">All</option>
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>

                    <!-- Center Filter -->
                    <div class="filter-group">
                        <label for="centerFilter">Centering</label>
                        <select id="centerFilter" class="filter-select">
                            <option value="all">All</option>
                            <option value="well_centered">Well Centered</option>
                            <option value="somewhat_centered">Somewhat Centered</option>
                            <option value="off_center">Off Center</option>
                        </select>
                    </div>

                    <!-- User Label Filter -->
                    <div class="filter-group">
                        <label for="labelFilter">User Label</label>
                        <select id="labelFilter" class="filter-select">
                            <option value="all">All</option>
                            <option value="favorite">‚≠ê Favorites</option>
                            <option value="delete">üóëÔ∏è Marked Delete</option>
                            <option value="unlabeled">Unlabeled</option>
                        </select>
                    </div>
                </div>

                <div class="filter-actions">
                    <button id="resetFilters" class="btn btn-secondary">Reset Filters</button>
                    <button id="loadNewFile" class="btn btn-secondary">Load New File</button>
                </div>
            </section>

            <!-- Batch Actions -->
            <section class="batch-actions-section" id="batchActions">
                <div class="batch-actions-row">
                    <div class="selection-controls">
                        <button id="selectAll" class="btn btn-secondary btn-sm">‚òëÔ∏è Select All Visible</button>
                        <button id="selectNone" class="btn btn-secondary btn-sm">‚òê Select None</button>
                        <span class="selection-info" id="selectionInfo">0 selected</span>
                    </div>
                    <div class="batch-buttons">
                        <button id="batchFavorite" class="btn btn-success btn-sm" disabled>‚≠ê Favorite</button>
                        <button id="batchDelete" class="btn btn-danger btn-sm" disabled>üóëÔ∏è Mark Delete</button>
                        <button id="batchClear" class="btn btn-secondary btn-sm" disabled>Clear Labels</button>
                        <button id="exportPaths" class="btn btn-primary btn-sm" disabled>üìã Export Paths</button>
                        <button id="exportLabels" class="btn btn-primary btn-sm">üíæ Export All Labels</button>
                    </div>
                </div>
            </section>

            <!-- Split View: Table + Preview -->
            <div class="split-view" id="splitView">
                <!-- Results Table -->
                <section class="results-section">
                    <div class="results-header">
                        <h2>üìä Results</h2>
                        <span class="results-count" id="resultsCount">0 of 0 photos</span>
                    </div>

                    <div class="table-container">
                        <table class="results-table" id="resultsTable">
                            <thead>
                                <tr>
                                    <th class="checkbox-col">
                                        <input type="checkbox" id="selectAllCheckbox" title="Select all visible">
                                    </th>
                                    <th class="thumbnail-col">Preview</th>
                                    <th class="sortable" data-sort="path">Path</th>
                                    <th class="sortable hide-mobile" data-sort="width">Size</th>
                                    <th class="sortable" data-sort="blur_score">Blur</th>
                                    <th>Person</th>
                                    <th>Dog</th>
                                    <th>Cat</th>
                                    <th class="sortable hide-mobile" data-sort="center_score">Center</th>
                                    <th>Label</th>
                                </tr>
                            </thead>
                            <tbody id="resultsBody">
                                <!-- Results will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Empty State -->
                    <div class="empty-state" id="emptyState" style="display: none;">
                        <div class="empty-icon">üîç</div>
                        <h3>No results match your filters</h3>
                        <p>Try adjusting the filter criteria above</p>
                    </div>
                </section>

                <!-- Preview Panel -->
                <aside class="preview-panel" id="previewPanel">
                    <div class="preview-header">
                        <h3>Preview</h3>
                        <button class="preview-close" id="closePreview">√ó</button>
                    </div>
                    <div class="preview-content" id="previewContent">
                        <div class="preview-placeholder">
                            <span>üëÜ</span>
                            <p>Click a photo to preview</p>
                            <p class="preview-hint">Use J/K to navigate, Space to select</p>
                        </div>
                    </div>
                    <div class="preview-details" id="previewDetails" style="display: none;">
                        <div class="preview-filename" id="previewFilename"></div>
                        <div class="preview-meta" id="previewMeta"></div>
                        <div class="preview-quick-actions">
                            <button class="btn btn-success btn-sm" id="quickFavorite">‚≠ê Favorite</button>
                            <button class="btn btn-danger btn-sm" id="quickDelete">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                </aside>
            </div>
        </main>

        <!-- Error Display -->
        <div class="error-message" id="errorMessage" style="display: none;">
            <span class="error-icon">‚ö†Ô∏è</span>
            <span class="error-text" id="errorText"></span>
            <button class="error-close" id="errorClose">&times;</button>
        </div>

        <!-- Toast Notification -->
        <div class="toast" id="toast" style="display: none;">
            <span class="toast-text" id="toastText"></span>
        </div>

        <!-- Keyboard Shortcuts Modal -->
        <div class="modal-overlay" id="helpModal" style="display: none;">
            <div class="modal">
                <div class="modal-header">
                    <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
                    <button class="modal-close" id="closeHelp">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="shortcuts-grid">
                        <div class="shortcut-group">
                            <h3>Navigation</h3>
                            <div class="shortcut"><kbd>J</kbd> / <kbd>‚Üì</kbd> Next photo</div>
                            <div class="shortcut"><kbd>K</kbd> / <kbd>‚Üë</kbd> Previous photo</div>
                            <div class="shortcut"><kbd>Enter</kbd> Open preview</div>
                            <div class="shortcut"><kbd>Esc</kbd> Close modal/preview</div>
                        </div>
                        <div class="shortcut-group">
                            <h3>Selection</h3>
                            <div class="shortcut"><kbd>Space</kbd> Toggle selection</div>
                            <div class="shortcut"><kbd>Ctrl+A</kbd> Select all visible</div>
                            <div class="shortcut"><kbd>Ctrl+Shift+A</kbd> Deselect all</div>
                        </div>
                        <div class="shortcut-group">
                            <h3>Quick Labels</h3>
                            <div class="shortcut"><kbd>F</kbd> Toggle favorite ‚≠ê</div>
                            <div class="shortcut"><kbd>D</kbd> Toggle delete mark üóëÔ∏è</div>
                            <div class="shortcut"><kbd>C</kbd> Clear label</div>
                        </div>
                        <div class="shortcut-group">
                            <h3>Other</h3>
                            <div class="shortcut"><kbd>?</kbd> Show this help</div>
                            <div class="shortcut"><kbd>R</kbd> Reset filters</div>
                            <div class="shortcut"><kbd>E</kbd> Export selected paths</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="review.js"></script>
</body>
</html>
